function readCookie(e){for(var i=e+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var n=t[a];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(i))return n.substring(i.length,n.length)}return null}function resizeTextarea(e){$(e).each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})}function dateDiffInDays(e,i){var t=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),a=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return d.getDate()>dia||d.getMonth()>mes||d.getFullYear>ano?0:Math.floor((a-t)/_MS_PER_DAY)}function listCards(){m=d.getMonth()+1<10?"0"+(d.getMonth()+1):d.getMonth()+1,day=d.getDate()<10?"0"+d.getDate():d.getDate(),date=d.getFullYear()+"-"+m+"-"+d.getDate(),$("#day-display").html(date!=hj?day+"/"+m:"HOJE"),date!=hj?$("#hj-helper").removeClass("is-hidden"):$("#hj-helper").addClass("is-hidden"),$("#btn-yesterday").prop("disabled",date==hj),$.ajax({url:"control/metodo/selectCards.php",dataType:"json",data:{date:date},beforeSend:function(){$("#cards-container").html("<p id='loading-cards'>Carregando...</p>")},success:function(e){if(""==e){var i=Math.floor(5*Math.random());$("#cards-container").html("<br><p>Sem revisões!</p><br><i class='is-size-1 far "+["fa-grin-hearts","fa-grin-stars","fa-smile-wink","fa-smile-beam","fa-smile"][i]+"'></i>")}data_review=e,$("#loading-cards").remove();for(var t=!1,a=0;a<=e.length-1;a++){var n=0==dateDiffInDays(new Date(data_review[a].date_review),new Date(hj))?"":"<span class='days-late-message is-uppercase has-text-danger'> ("+dateDiffInDays(new Date(data_review[a].date_review),new Date(hj))+" "+(1==dateDiffInDays(new Date(data_review[a].date_review),new Date(hj))?"dia":"dias")+" de atraso)</span>";if(t!==e[a].study_field)var d=""==e[a].study_field||null==e[a].study_field?"Sem disciplina":e[a].study_field,s=$("<div class='study-field-wrapper'><div class='study-field has-text-left has-text-weight-bold'><span class='name-studyfield'>"+d+"</span><span class='chevron-studyfield'><i class='fa fa-chevron-down'></i></span></div>").appendTo("#cards-container");$("<div class='box-wrapper'><i class='far fa-square' id='checker'></i><div class='box'><input type='hidden' name='pos_array' value="+a+"><article class='media'><div class='media-left'></div><div class='media-left'></div><div class='media-content'><div class='content'><p><strong class='review-title'>"+e[a].title_review+n+"</strong></p></div></div></article></div></div>").appendTo($(s)),t=e[a].study_field}}})}function listStudyField(){$.ajax({url:"control/metodo/listStudyField.php",success:function(e){$("#div-add-field-dropdown-menu").html(e),listStudyFieldToModal()}})}function addStudyField(e){$.ajax({url:"control/metodo/addStudyField.php",data:{study_field:e},success:function(i){$('<option value="'+e+'">'+e+"</option>").appendTo("#modal-select-studyfield")}})}function changeStudyField(e,i){$.ajax({url:"control/metodo/changeStudyField.php",data:{study_field:e,id:i},success:function(){listCards()}})}function addReviewCicle(e){$.ajax({url:"control/metodo/addReviewCicle.php",data:{config_cicle:e},success:function(e){}})}function listReviewCicle(){$.ajax({url:"control/metodo/listReviewCicle.php",success:function(e){$(e).appendTo("#div-add-cicle-dropdown-menu")}})}function listStudyFieldToModal(){$.ajax({url:"control/metodo/listStudyFieldToModal.php",success:function(e){$(e).appendTo("#modal-select-studyfield")}})}d=new Date,hj=d.getFullYear()+"-"+(d.getMonth()+1<10?"0"+(d.getMonth()+1):d.getMonth()+1)+"-"+d.getDate(),dia=d.getDate(),mes=d.getMonth(),ano=d.getFullYear(),data_review=[],array_position=null,_MS_PER_DAY=864e5,listCards(),listStudyField(),listReviewCicle(),0==readCookie("tutorial_feito")&&$(".tutorial").removeClass("is-hidden"),$(document).on("click","#hj-helper",function(){d.setMonth(mes),d.setFullYear(ano),d.setDate(dia),listCards()}),$(document).on("click","#btn-tomorrow",function(){d.setDate(d.getDate()+1),listCards()}),$(document).on("click","#btn-yesterday",function(){d.setDate(d.getDate()-1),listCards()}),$("#myModal").on("shown.bs.modal",function(){$("#myInput").focus()}),$(document).ready(function(){$(document).on("click",".navbar-burger",function(){$(".navbar-menu").toggleClass("is-active")}),$(document).on("click",".navbar-item",function(){$(this).toggleClass("is-active")}),$(document).on("keydown","#input-field-dropdown",function(e){if($.trim($(this).val())){if(13==e.keyCode){var i=$(this).val();$("<a class='dropdown-item dropdown-item-add-field'><span class='icon is-small'><i class='far fa-circle'></i></span><span class='field-dropdown'>"+i+"</span></a>").appendTo("#div-add-field-dropdown-menu"),$(this).val(""),addStudyField(i),$("#field-choicer").html(i),$("#btn-add-field").parent().parent().toggleClass("is-active")}}else;}),$(document).on("click","#input-field-dropdown",function(e){if($.trim($(this).val())){var i=$(this).val();$("#field-choicer").html(i),$("#input-field-dropdown").val(""),$("<a class='dropdown-item dropdown-item-add-field'><span class='icon is-small'><i class='far fa-circle'></i></span><span class='field-dropdown'>"+i+"</span></a>").appendTo("#div-add-field-dropdown-menu"),$("#btn-add-field").parent().parent().toggleClass("is-active"),addStudyField(i)}}),$(document).on("click","#icon-input-field-dropdown",function(){var e=$("#input-field-dropdown").val();$.trim(e)&&($("<a class='dropdown-item dropdown-item-add-field'><span class='icon is-small'><i class='far fa-circle'></i></span><span class='field-dropdown'>"+e+"</span></a>").appendTo("#div-add-field-dropdown-menu"),addStudyField(e)),$("#input-field-dropdown").val("")}),$(document).on("click",".dropdown-item-add-field",function(){$("#field-choicer").html($(this).find(".field-dropdown").text()),$("#btn-add-field").parent().parent().toggleClass("is-active")}),$(document).on("click","#a-input-field-dropdown",function(){$("#input-field-dropdown").focus()}),$(document).on("click","#btn-add-field",function(){$(this).parent().parent().toggleClass("is-active"),$("#btn-add-cicle").parent().parent().removeClass("is-active")}),$(document).on("keydown","#input-cicle-dropdown",function(e){if($.trim($(this).val())){if(13==e.keyCode){var i=$(this).val(),t=i.split("-");isNaN(parseInt(t))?$("#add-cicle-notification").html("Use apenas números"):t.length<2?$("#add-cicle-notification").html("Pelo menos dois dias"):($("<a class='dropdown-item dropdown-item-add-cicle'><span class='icon is-small'><i class='far fa-circle'></i></span><span class='cicle-dropdown'>"+i+"</span></a>").appendTo("#div-add-cicle-dropdown-menu"),$(this).val(""),$("#cicle-choicer").html(i),$("#btn-add-cicle").parent().parent().toggleClass("is-active"),addReviewCicle(i))}}else;}),$(document).on("click","#input-cicle-dropdown",function(e){if($.trim($(this).val())){var i=$(this).val();$("#cicle-choicer").html(i),$("#input-cicle-dropdown").val(""),$("<a class='dropdown-item dropdown-item-add-cicle'><span class='icon is-small'><i class='far fa-circle'></i></span><span class='cicle-dropdown'>"+i+"</span></a>").appendTo("#div-add-cicle-dropdown-menu"),$("#btn-add-cicle").parent().parent().toggleClass("is-active"),addReviewCicle(i)}}),$(document).on("click","#icon-input-cicle-dropdown",function(){var e=$("#input-cicle-dropdown").val();$.trim(e)&&($("<a class='dropdown-item dropdown-item-add-cicle'><span class='icon is-small'><i class='far fa-circle'></i></span><span class='cicle-dropdown'>"+e+"</span></a>").appendTo("#div-add-cicle-dropdown-menu"),addReviewCicle(e)),$("#input-cicle-dropdown").val("")}),$(document).on("click",".dropdown-item-add-cicle",function(){$("#cicle-choicer").html($(this).find(".cicle-dropdown").text()),$("#btn-add-cicle").parent().parent().toggleClass("is-active")}),$(document).on("click","#a-input-cicle-dropdown",function(){$("#input-cicle-dropdown").focus()}),$(document).on("click","#btn-add-cicle",function(){$(this).parent().parent().toggleClass("is-active"),$("#btn-add-field").parent().parent().removeClass("is-active")}),$(document).on("click","#btn-add-set",function(){var e=$("#input-title-review").val(),i=$("#description").val(),t="disciplina"==$("#field-choicer").text()?"":$("#field-choicer").text();switch($("#cicle-choicer").text()){case"ciclo":var a="ciclo"==$("#cicle-choicer").text()?"1-7-15-30":$("#cicle-choicer").text();break;case"todos os dias":a="todos os dias"==$("#cicle-choicer").text()?"1-1-1":$("#cicle-choicer").text();break;default:a=$("#cicle-choicer").text()}$.trim($("#input-title-review").val())&&($(this).prop("disabled",!0),$.ajax({url:"control/metodo/addReview.php",method:"POST",data:{title:e,description:i,field:t,cicle:a},beforeSend:function(){$("#btn-add-set").addClass("is-loading")},success:function(e){$("#input-title-review").val(""),$("#description").val(""),$("#description").css("height","unset"),$("#new-set-wrapper").removeClass("new-set-wrapper-on"),$(".new-set-toggle").hide(),$("#add-set-notification").stop().animate({opacity:"100"}),$("#add-set-notification").show(),listCards()},complete:function(){var i=a.split("-"),t=1==i[0]?"amanhã.":"em "+i[0]+" dias.";$("#add-set-notification").html("<strong>'"+e+"'</strong> será revisado "+t),$("#add-set-notification").removeClass("is-hidden"),$("#add-set-notification").fadeOut(3e3),$("#btn-add-set").removeClass("is-loading"),$("#btn-add-set").prop("disabled",!1)}}))}),$(document).on("mouseover","#add-set-notification",function(){$(this).stop().animate({opacity:"100"})}),$(document).on("mouseout","#add-set-notification",function(){$(this).fadeOut(3e3)}),$(document).click(function(e){$(e.target).closest("#new-set-wrapper").length||($("#new-set-wrapper").removeClass("new-set-wrapper-on"),$(".new-set-toggle").hide())}),$(".new-set-toggle").hide(),$("#input-title-review,#label-add,#description").on("click keydown",function(e){$("#new-set-wrapper").addClass("new-set-wrapper-on"),$(".new-set-toggle").show(),$(".auto-expand").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),e.ctrlKey&&13==e.keyCode&&$("#btn-add-set").trigger("click")}),$(document).on("change","#modal-select-studyfield",function(){$(this).val()==data_review[array_position].study_field||changeStudyField($(this).val(),data_review[array_position].id_review)}),$(document).on("click",".modal-background,.delete",function(){$(".modal").removeClass("is-active"),$(".modal-card-title").text(""),$("#input-description").val(""),$("#input-description").css("height","unset"),$("#modal-select-studyfield").val("")}),$(document).on("click","#btn-pre-archive",function(){$(this).parent().parent().toggleClass("is-active")}),$(document).click(function(e){(!$(e.target).closest("#dropdown-archivereview").length&&"btn-pre-archive"!=$(e.target).prop("id")&&"dropdown-archivereview"!=$(e.target).prop("id")||"modal"==$(e.target).prop("className"))&&(-1!=$("#btn-pre-archive").parent().parent().prop("className").split(" ").indexOf("is-active")&&$("#btn-pre-archive").parent().parent().removeClass("is-active"))}),$(document).on("click","#archive-card",function(){$(this).addClass("is-loading");var e=data_review[array_position].id_review;$.ajax({url:"control/metodo/archiveCard.php",data:{id:e},success:function(e){},complete:function(){$(".modal").removeClass("is-active"),listCards(),$("#archive-card").removeClass("is-loading")}})}),$(document).on("click keydown","#input-description",function(){$("#input-description").css("cursor","text"),$("#save-description").text("Salvar"),$("#save-description").show()}),$(document).on("keydown","#input-description",function(e){e.ctrlKey&&13==e.keyCode&&$("#save-description").trigger("click")}),$(document).on("click","#save-description",function(){var e=$("#input-description").val(),i=data_review[array_position].id_review;data_review[array_position].desc_review=e,$.ajax({url:"control/metodo/updateDescription.php",data:{id:i,desc:e},beforeSend:function(){$("#save-description").addClass("is-loading")},complete:function(){$("#save-description").addClass("is-loading"),setTimeout("$('#save-description').removeClass('is-loading')",500),setTimeout("$('#save-description').text('Salvo!')",500),setTimeout("$('#save-description').hide()",1e3),setTimeout("$('#input-description').css('border','none')",1e3),setTimeout("$('#input-description').css('box-shadow','none')",1e3),setTimeout("$('#input-description').css('cursor','pointer')",1e3),setTimeout("$('#input-description').css('resize','none')",1e3)}})}),$(document).on("keyup",function(e){27==e.keyCode&&$(".modal").removeClass("is-active")}),$(document).on("click",".study-field",function(){$(this).parent().find(".box-wrapper").toggleClass("is-hidden"),$(this).find(".chevron-studyfield").toggleClass("rotate-90deg")}),$(document).on("click",".box",function(){array_position=$(this).find("input[name=pos_array]").val(),$(".modal-card-title").text(data_review[array_position].title_review),$("#input-description").val(data_review[array_position].desc_review),$("#modal-select-studyfield").val(data_review[array_position].study_field).change(),$(".modal").addClass("is-active"),resizeTextarea("#input-description"),""!=$("#input-description").val()&&($("#input-description").css("border","none"),$("#input-description").css("box-shadow","none"),$("#input-description").css("cursor","pointer"),$("#input-description").css("resize","none"),$("#save-description").hide())}),$(document).on("mouseover",".animated",function(){$(this).stop().animate(),$(this).css("opacity",1),ajaxRequest=!1}),$(document).on("mouseleave",".animated",function(){$(this).fadeOut(3e3,function(){if(wrapper=$(this).closest(".study-field-wrapper"),$(this).remove(),1==$(wrapper).children().length&&$(wrapper).remove(),0==$("#cards-container").children().length){var e=Math.floor(5*Math.random());$("#cards-container").html("<br><p>Parabéns!</p><br><i class='is-size-1 far "+["fa-grin-hearts","fa-grin-stars","fa-smile-wink","fa-smile-beam","fa-smile"][e]+"'></i>")}})}),$(document).on("click","#unchecker",function(e){var i=$(this).parent().find("input[name=pos_array]").val(),t=data_review[i].id_review,a=parseInt(data_review[i].step_cicle),n=data_review[i].date_review;$.ajax({url:"control/metodo/scheduleNextReview.php",method:"POST",data:{id:t,ciclo:a,date_review:n},success:function(e){}}),$(this).parent().stop().animate(),$(this).parent().css("opacity",1),$(this).parent().removeClass("animated"),$(this).parent().children().find(".next-review-message").remove(),$(this).parent().find(".days-late-message").show(),$(this).remove()}),$(document).on("click","#checker",function(e){$('<i class="far fa-check-square" id="unchecker"></i>').appendTo($(this).parent());var i=$(this).next().find("input[name=pos_array]").val(),t=data_review[i].id_review,a=parseInt(data_review[i].step_cicle)+1,n=data_review[i].config_cicle.split("-"),d=null==n[a]?n[n.length-1]:n[a-1],s=1==d?"dia":"dias";$(this).parent().addClass("animated"),$(this).parent().fadeOut(3e3,function(){if(wrapper=$(this).closest(".study-field-wrapper"),$(this).remove(),1==$(wrapper).children().length&&$(wrapper).remove(),0==$("#cards-container").children().length){var e=Math.floor(5*Math.random());$("#cards-container").html("<br><p>Parabéns!</p><br><i class='is-size-1 far "+["fa-grin-hearts","fa-grin-stars","fa-smile-wink","fa-smile-beam","fa-smile"][e]+"'></i>")}}),$(this).next().find(".days-late-message").hide();var o=$(this).next().find(".review-title");$('<span class="has-text-weight-normal has-text-info next-review next-review-message "><span class="has-text-black">:</span> próxima revisão em '+d+" "+s+"</span>").appendTo($(o)),$.ajax({url:"control/metodo/scheduleNextReview.php",method:"POST",data:{id:t,ciclo:a,interval:d},success:function(e){}})})});